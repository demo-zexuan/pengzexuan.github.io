---
title: "从种草笔记项目中一窥推荐系统"
categories: [ "微盟", "工作记录" ]
tags: [ "种草笔记", "微盟", "推荐系统" ]
---

## 1. 什么是推荐系统？

### 内容平台——业务场景角度切入

推荐系统的最终目的并非是为了单纯的追求技术指标的最大化，而是站在业务的角度上，构建一个能够让
所有参与方长期受益的健康生态，而对于整个生态而言，核心存在三个支点：用户、内容创作者和平台。

而随着互联网生态的发展，用户与创作者之间的界限变得越来越模糊，用户既是内容的消费者，也是内容的生产者，
而内容创作者也需要通过生产优质内容来吸引用户，从而获得更多的关注和收益。因此，推荐系统需要在满足用户需求的同时，
也要考虑内容创作者的利益，促进内容的多样性和质量提升。

以上的业务场景迭代催生了内容业务的多样化的生产模式：

### UGC（User Generated Content，用户生成内容）

UGC是指由用户自行创作和发布的内容，通常包括文字、图片、视频等形式。UGC的优点在于内容丰富多样，能够满足不同用户的需求，同时也能够激发用户的参与感和创造力。然而，UGC的质量参差不齐，平台需要通过推荐系统来筛选和推荐优质内容，以提升用户体验。

### PGC（Professional Generated Content，专业生产内容）

PGC是指由专业机构或个人创作和发布的内容，通常具有较高的质量和专业性。PGC的优点在于内容质量有保障，能够提供深度和权威的信息。然而，PGC的生产成本较高，平台需要通过推荐系统来提高PGC的曝光率和用户参与度，以实现内容的商业价值。

### SGC（Sponsored Generated Content，商业化生产内容）

SGC是指由商业机构或个人创作和发布的内容，通常以广告或推广为目的。SGC的优点在于能够为平台带来直接的商业收益，同时也能够为用户提供有价值的产品和服务信息。然而，SGC可能会影响用户体验，平台需要通过推荐系统来平衡商业利益和用户需求，以维护生态的健康发展。

---

多样化的内容生产模式使得推荐系统在设计和优化时需要考虑更多的因素，以实现用户、内容创作者和平台三方的共赢。

- 对于**内容**而言，推荐系统需要在理解内容属性的基础之上，建立更丰富的匹配推荐机制，一个健康的内容生态不仅要分发受欢迎的内容，更要持续的发掘潜力内容，避免平台生态滑向“头部集中、长尾沉没”的局面。

- 对于**用户**而言，推荐系统需要深入理解用户的兴趣和需求，提供个性化的推荐服务，同时也要引导用户发现多样化的内容，避免信息茧房效应的产生。

- 对于**平台**而言，推荐系统需要平衡各方利益，促进内容的多样性和质量提升，同时也要考虑商业化的需求，实现平台的可持续发展。

<img src="https://datawhalechina.github.io/fun-rec/_images/ecosystem_balance.svg" alt=""/>

**真正优秀的推荐系统，一定是一个精巧的平衡器**。它需要在用户与创作者、内容质量、平台发展之间找到动态平衡点，确保生态系统的长期健康。这要求推荐系统设计者不仅是技术专家，更需要具备生态思维，能够从多方利益的角度思考问题。

### 推荐的本质是对于关系的量化预测

推荐系统的核心任务是通过对用户与内容之间关系的量化预测，来实现个性化推荐。具体来说，推荐系统需要通过分析用户的历史行为数据（如浏览、点击、收藏、购买等）和内容的属性信息（如类别、标签、关键词等），建立用户与内容之间的关联模型，从而预测用户对未接触过的内容的兴趣程度。

故而对于推荐系统而言，核心是需要理解三个关键要素 —— 用户（User）、物品（Item）、上下文（Context）。

#### 理解用户

系统需要通过多维度的数据来刻画用户的兴趣和需求，包括但不限于用户的基本信息（如年龄、性别、地域等）、行为数据（如浏览历史、点击记录、购买行为等）以及社交关系（如好友关系、关注列表等）。通过对这些数据的分析，推荐系统可以构建用户画像，进而实现个性化推荐。

而工业界与此最为相关的系统就是CDP（Customer Data Platform，客户数据平台），CDP通过整合和分析来自不同渠道的用户数据，帮助企业更好地理解用户需求，提升用户体验，从而实现精准营销和个性化推荐。

#### 理解物品

物品即推荐系统中被推荐的内容或商品。理解物品需要对其属性进行全面的分析和建模，包括但不限于物品的类别、标签、关键词、价格、品牌等信息。此外，还需要考虑物品的质量、受欢迎程度、用户评价等因素，以便更好地匹配用户的兴趣和需求。

当然，物品的理解不仅仅局限于静态属性，还需要考虑物品的动态变化，如库存状态、促销活动、新品发布等，这些因素都会影响用户的购买决策和推荐效果。

我们所实际要关注的物品的属性需要根据具体的业务场景进行定义和调整，不同类型的推荐系统可能会关注不同的物品属性。例如，在电商推荐系统中，价格和品牌可能是重要的属性，而在内容推荐系统中，类别和标签可能更为关键。

#### 理解上下文

上下文是指用户在特定时间和环境下的状态和需求。理解上下文需要考虑多种因素，如时间（如季节、节假日、时间段等）、地点（如地理位置、场所类型等）、设备（如手机、电脑、平板等）以及用户的当前情绪和行为状态等。通过对上下文的分析，推荐系统可以更好地把握用户的即时需求，提供更加精准和个性化的推荐服务。

用户和内容的连接从不发生在真空中，场景因素往往决定了推荐的成败。现在是工作日的上午还是周末的深夜？用户是在拥挤的地铁上还是安静的家中？这些看似细微的差别，实际上会显著影响用户的内容偏好。一个在地铁上通勤的用户更可能对短视频感兴趣，而在家中休闲的用户则可能愿意观看较长的深度内容。

<img src="https://datawhalechina.github.io/fun-rec/_images/score_function.svg" alt=""/>

---

## 2. 推荐系统的整体流程

我们已经介绍过了，推荐的本质是对于关系的量化预测，那么在工业界我们核心面对的问题是数据的规模，即我们会有海量的数据（物品的集合），以及海量的用户（用户的集合），而我们需要做的事情是从海量的数据中为每一个用户挑选出最合适的物品进行推荐。

整体的数据我们需要进行平衡，即一个用户ToC的操作，需要的时间是极短的，我们如何在有限的时间内从海量的数据中挑选出最合适的物品进行推荐呢？这就需要我们对推荐系统进行整体的流程设计。

目前工业界的推荐系统整体采用漏斗式的设计思路，整体可以分为四个阶段：
1. **数据收集与预处理（数据采集）**：在这个阶段，系统需要收集用户的行为数据和物品的属性数据，并对这些数据进行清洗、去重、归一化等预处理操作，以确保数据的质量和一致性。
2. **候选集生成（召回）**：在这个阶段，系统需要从海量的物品中筛选出一个相对较小的候选集，这个候选集应该包含用户可能感兴趣的物品。常用的方法包括基于内容的过滤、协同过滤、基于规则的筛选等。
3. **排序与推荐（排序）**：在这个阶段，系统需要对候选集中的物品进行排序，选择最符合用户兴趣的物品进行推荐。常用的方法包括机器学习模型、深度学习模型、强化学习模型等。
4. **重排（掺杂）**：在这个阶段，系统需要对排序后的物品进行进一步的调整和优化，以提升推荐的多样性、新颖性和用户满意度。常用的方法包括多样性重排、新颖性重排等。

<img src="https://datawhalechina.github.io/fun-rec/_images/recommendation_pipeline.svg" alt="">

---

## 3. 数据采集

---


## 4. 召回模型

召回模型的目标是从海量的物品中快速筛选出一个相对较小的候选集，这个候选集应该包含用户可能感兴趣的物品。召回模型通常需要具备高效性和覆盖率，以确保在有限的时间内能够为用户提供足够多样化的推荐选项。

召回模型整体可以分为以下几类：
1. 协同过滤（Collaborative Filtering）：基于用户的历史行为数据，通过分析用户之间的相似性来推荐物品。常用的方法包括基于用户的协同过滤和基于物品的协同过滤。
2. 向量召回（Vector-based Retrieval）：通过将用户和物品映射到一个高维向量空间中，利用向量之间的距离或相似度来进行召回。常用的方法包括基于深度学习的嵌入模型，如Word2Vec、Doc2Vec等。
3. 序列召回（Sequential Retrieval）：考虑用户的行为序列，通过分析用户的历史行为顺序来推荐物品。常用的方法包括基于RNN、Transformer等深度学习模型。

### 4.1 协同过滤

协同过滤（Collaborative Filtering）是一种基于用户历史行为数据的推荐方法，旨在通过分析用户之间的相似性来推荐物品。协同过滤的核心思想是“物以类聚，人以群分”，即相似的用户往往会喜欢相似的物品。

这个想法最早在1992年的Tapestry系统 (Goldberg et al., 1992) 中被提出，后来在Amazon、Netflix等公司得到了广泛应用。

协同过滤的原理可以简单描述为：首先收集用户的历史行为数据（如评分、点击、购买记录），然后计算用户之间或物品之间的相似度，最后基于这些相似度为用户生成推荐。

基于计算相似性使用的目标不同，协同过滤可以分为两种主要类型：
<ol type="A">
    <li>
        <p>基于物品的协同过滤（Item-based Collaborative Filtering, ItemCF）：通过计算物品之间的相似度，找到与目标物品相似的其他物品，然后推荐这些物品给用户。</p>
        <p>ItemCF 在工业界应用更广泛，早在2003年，Amazon就成功的将ItemCF用于其电商推荐</p>
    </li>
    <li>
        <p>基于用户的协同过滤（User-based Collaborative Filtering, UserCF）：通过计算用户之间的相似度，找到与目标用户兴趣相似的其他用户，然后推荐这些用户喜欢的物品给目标用户。</p>
        <p>相较于ItemCF，UserCF更擅长发现用户的潜在的兴趣点和提供新颖性的推荐，因为相似用户可能会喜欢目标用户从未接触过的物品类别。然而，UserCF在实际应用中面临更大的挑战：用户兴趣变化快、用户数量庞大导致计算复杂度高、用户行为稀疏性使得相似度计算不稳定。这些问题使得UserCF在大规模工业系统中的应用相对有限，但其“通过群体智慧进行推荐”的核心思想为后续的深度学习方法提供了重要启发。</p>
    </li>
    <li>
        <p>矩阵分解（Matrix Factorization）：将用户-物品交互矩阵分解为两个低维矩阵，分别表示用户和物品的隐含特征，通过这些隐含特征来进行推荐。</p>
        <p>通过学习用户和物品的低维向量表示来预测偏好，实现了U2I的直接召回。这标志着协同过滤从基于邻域的统计方法向基于模型的学习方法转变，其向量化表示的思想为后续的向量召回技术奠定了基础。</p>
    </li>
</ol>

#### A. 基于物品的协同过滤（Item-based Collaborative Filtering, ItemCF）

##### 基本原理

ItemCF建立在这样的一个简单的假设上：用户的兴趣是具备一定的连贯性的，即如果一个用户喜欢某个物品，那么他很可能也会喜欢与该物品相似的其他物品。基于这个假设，ItemCF核心关注的是“和你喜欢的物品相似的物品有哪些”这一问题。

<img src="https://datawhalechina.github.io/fun-rec/_images/itemcf_illustration.svg" alt="">

从上图可以看到，当我们要给左方用户推荐物品时，ItemCF会分析T恤和夹克之间的相似性。由于右方三个用户都同时喜欢这两种服装，系统判断它们具有较高的相似性。既然左方用户喜欢T恤，那么夹克就成为了一个不错的推荐选择。

##### ItemCF核心算法

ItemCF的核心算法可以分为以下几个步骤：

###### 第一步：计算物品相似度



#### B. 基于用户的协同过滤（User-based Collaborative Filtering, UserCF）



### 4.2 向量召回

### 4.3 序列召回


---

## 5. 精排模型

---

## 6. 重排模型

---
